openapi: 3.0.0
info:
  title: Nexus Social Media API
  version: 1.0.0
  description: API complète pour une application de médias sociaux avec authentification Clerk
  contact:
    name: Support API
    email: support@nexus.com

servers:
  - url: http://localhost:3000/api
    description: Serveur de développement
  - url: https://votre-domaine.com/api
    description: Serveur de production

components:
  securitySchemes:
    ClerkAuth:
      type: apiKey
      in: header
      name: Authorization
      description: Token d'authentification Clerk

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        clerk_id:
          type: string
        username:
          type: string
        fullname:
          type: string
        email:
          type: string
        bio:
          type: string
        image:
          type: string
        followers:
          type: integer
        following:
          type: integer
        posts:
          type: integer
        created_at:
          type: string
          format: date-time

    Post:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        image_url:
          type: string
        storage_id:
          type: string
        caption:
          type: string
        likes:
          type: integer
        comments:
          type: integer
        created_at:
          type: string
          format: date-time
        author:
          $ref: '#/components/schemas/User'
        isLiked:
          type: boolean
        isBookmarked:
          type: boolean

    Comment:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        post_id:
          type: string
          format: uuid
        content:
          type: string
        created_at:
          type: string
          format: date-time
        user:
          type: object
          properties:
            fullname:
              type: string
            image:
              type: string

    Notification:
      type: object
      properties:
        _id:
          type: string
          format: uuid
        receiver_id:
          type: string
          format: uuid
        sender_id:
          type: string
          format: uuid
        type:
          type: string
          enum: [like, comment, follow]
        post_id:
          type: string
          format: uuid
        comment_id:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        sender:
          type: object
          properties:
            _id:
              type: string
              format: uuid
            username:
              type: string
            image:
              type: string
        post:
          type: object
          properties:
            _id:
              type: string
              format: uuid
            imageUrl:
              type: string

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string

    Success:
      type: object
      properties:
        message:
          type: string

paths:
  # =========================================
  # Routes Webhooks (sans authentification)
  # =========================================
  /webhooks/clerk:
    post:
      summary: Webhook Clerk pour la création d'utilisateurs
      description: Endpoint webhook pour créer des utilisateurs lors de l'inscription via Clerk
      tags:
        - Webhooks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                email_addresses:
                  type: array
                  items:
                    type: object
                    properties:
                      email_address:
                        type: string
                first_name:
                  type: string
                last_name:
                  type: string
                image_url:
                  type: string
                username:
                  type: string
      responses:
        '201':
          description: Utilisateur créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '200':
          description: Utilisateur déjà existant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Utilisateurs
  # =========================================
  /users/profile/{id}:
    get:
      summary: Obtenir le profil d'un utilisateur
      description: Récupère les informations du profil utilisateur par ID
      tags:
        - Users
      security:
        - ClerkAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Profil utilisateur récupéré avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Utilisateur non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/profile:
    put:
      summary: Mettre à jour le profil utilisateur
      description: Met à jour les informations du profil de l'utilisateur connecté
      tags:
        - Users
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fullname:
                  type: string
                bio:
                  type: string
      responses:
        '200':
          description: Profil mis à jour avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/is-following/{followingId}:
    get:
      summary: Vérifier si on suit un utilisateur
      description: Vérifie si l'utilisateur connecté suit un autre utilisateur
      tags:
        - Users
      security:
        - ClerkAuth: []
      parameters:
        - name: followingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Statut de suivi récupéré
          content:
            application/json:
              schema:
                type: object
                properties:
                  isFollowing:
                    type: boolean
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /users/toggle-follow:
    post:
      summary: Suivre/Ne plus suivre un utilisateur
      description: Permet de suivre ou de ne plus suivre un utilisateur
      tags:
        - Users
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - followingId
              properties:
                followingId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Statut de suivi modifié
          content:
            application/json:
              schema:
                type: object
                properties:
                  followed:
                    type: boolean
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Posts
  # =========================================
  /posts:
    post:
      summary: Créer un nouveau post
      description: Crée un nouveau post avec texte et/ou image
      tags:
        - Posts
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                caption:
                  type: string
                image:
                  type: string
                  format: binary
      responses:
        '201':
          description: Post créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Post'
        '400':
          description: Données invalides
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /posts/feed:
    get:
      summary: Obtenir le flux de posts
      description: Récupère tous les posts pour le flux principal
      tags:
        - Posts
      security:
        - ClerkAuth: []
      responses:
        '200':
          description: Flux récupéré avec succès
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /posts/user/{userId}:
    get:
      summary: Obtenir les posts d'un utilisateur
      description: Récupère tous les posts d'un utilisateur spécifique
      tags:
        - Posts
      security:
        - ClerkAuth: []
      parameters:
        - name: userId
          in: path
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Posts récupérés avec succès
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /posts/{postId}:
    delete:
      summary: Supprimer un post
      description: Supprime un post et toutes ses données associées
      tags:
        - Posts
      security:
        - ClerkAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Post supprimé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '404':
          description: Post non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /posts/toggle-like:
    post:
      summary: Aimer/Ne plus aimer un post
      description: Permet d'aimer ou de ne plus aimer un post
      tags:
        - Posts
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postId
              properties:
                postId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Statut de like modifié
          content:
            application/json:
              schema:
                type: object
                properties:
                  liked:
                    type: boolean
        '404':
          description: Post non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Commentaires
  # =========================================
  /comments:
    post:
      summary: Ajouter un commentaire
      description: Ajoute un commentaire à un post
      tags:
        - Comments
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
                - postId
              properties:
                content:
                  type: string
                postId:
                  type: string
                  format: uuid
      responses:
        '201':
          description: Commentaire ajouté avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '404':
          description: Post non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /comments/{postId}:
    get:
      summary: Obtenir les commentaires d'un post
      description: Récupère tous les commentaires d'un post spécifique
      tags:
        - Comments
      security:
        - ClerkAuth: []
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Commentaires récupérés avec succès
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Bookmarks
  # =========================================
  /bookmarks/toggle:
    post:
      summary: Ajouter/Retirer un bookmark
      description: Permet d'ajouter ou de retirer un post des favoris
      tags:
        - Bookmarks
      security:
        - ClerkAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - postId
              properties:
                postId:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Statut de bookmark modifié
          content:
            application/json:
              schema:
                type: object
                properties:
                  bookmarked:
                    type: boolean
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /bookmarks:
    get:
      summary: Obtenir les posts bookmarkés
      description: Récupère tous les posts favoris de l'utilisateur connecté
      tags:
        - Bookmarks
      security:
        - ClerkAuth: []
      responses:
        '200':
          description: Bookmarks récupérés avec succès
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Notifications
  # =========================================
  /notifications:
    get:
      summary: Obtenir les notifications
      description: Récupère toutes les notifications de l'utilisateur connecté
      tags:
        - Notifications
      security:
        - ClerkAuth: []
      responses:
        '200':
          description: Notifications récupérées avec succès
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'
        '500':
          description: Erreur interne du serveur
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # =========================================
  # Routes Système
  # =========================================
  /health:
    get:
      summary: Vérifier l'état du serveur
      description: Endpoint de santé pour vérifier que le serveur fonctionne
      tags:
        - System
      responses:
        '200':
          description: Serveur fonctionne correctement
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  environment:
                    type: string

tags:
  - name: Webhooks
    description: Endpoints webhooks pour les services externes
  - name: Users
    description: Gestion des utilisateurs et profils
  - name: Posts
    description: Gestion des publications
  - name: Comments
    description: Gestion des commentaires
  - name: Bookmarks
    description: Gestion des favoris
  - name: Notifications
    description: Gestion des notifications
  - name: System
    description: Endpoints système et santé